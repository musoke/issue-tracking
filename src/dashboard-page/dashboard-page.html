<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/bower_components/polymer/lib/elements/dom-repeat.html">

<link rel="import" href="issue.html">

<dom-module id="dashboard-page">
   <template>
       <link rel="stylesheet" href="/src/dashboard-page/dashboard-page.css">

       Filter: <input id="filter" on-change="handleFilter" value="{{filter::change}}">
       <a id="newIssue" href="/new">New Issue</a>

       <h1>Matching issues</h1>
        <iron-ajax auto url="/api/issues/{{ filter }}/{{ query }}" handle-as="json"
                   last-response="{{ issues }}"></iron-ajax>
        <template is="dom-repeat" items="{{ issues }}">
            <sit-issue issue="{{item}}"></sit-issue>
        </template>
    </template>

    <script>
        class DashboardPage extends Polymer.Element {
            static get is() { return 'dashboard-page'; }
            static get properties() {
                return {
                    filter: {
                        type: String,
                        value: "`true`"
                    }
                }
            }

            handleFilter() {
                window.history.pushState({}, null, `/search/${this.$.filter.value}`);
            }

            constructor() {
                super();
                this.query = "{id: id, summary: summary}";
            }
        }
        customElements.define(DashboardPage.is, DashboardPage);
    </script>
</dom-module>

